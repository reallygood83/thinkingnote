/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository
*/

var I=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var J=(f,c)=>{for(var t in c)I(f,t,{get:c[t],enumerable:!0})},q=(f,c,t,e)=>{if(c&&typeof c=="object"||typeof c=="function")for(let i of j(c))!Y.call(f,i)&&i!==t&&I(f,i,{get:()=>c[i],enumerable:!(e=W(c,i))||e.enumerable});return f};var H=f=>q(I({},"__esModule",{value:!0}),f);var z={};J(z,{default:()=>x});module.exports=H(z);var a=require("obsidian"),S="thinking-tool-connections",U=" - Materials",L=6e4,E=3,X=1e3,G={aiProvider:"gemini",openaiApiKey:"",anthropicApiKey:"",geminiApiKey:"",openaiModel:"gpt-4o",anthropicModel:"claude-sonnet-4-20250514",geminiModel:"gemini-2.5-flash",materialNoteFolder:"",connectionsLimit:20,outputLanguage:"\uD55C\uAD6D\uC5B4"},x=class extends a.Plugin{constructor(){super(...arguments);this.settings=G;this.session={isActive:!1,sourceFilePath:null,materialNotePath:null,leftLeafId:null,centerLeafId:null,rightLeafId:null};this.floatingBtn=null;this.currentSelection=""}async onload(){await this.loadSettings(),this.registerView(S,t=>new C(t,this)),this.addCommand({id:"start-thinking-session",name:"Start Thinking Session",checkCallback:t=>{let e=this.app.workspace.getActiveFile();return e?(t||this.startThinkingSession(e),!0):!1}}),this.addCommand({id:"end-thinking-session",name:"End Thinking Session",checkCallback:t=>this.session.isActive?(t||this.endThinkingSession(),!0):!1}),this.addCommand({id:"generate-article",name:"Generate Article from Materials",checkCallback:t=>this.session.isActive&&this.session.materialNotePath?(t||this.openGenerateModal(),!0):!1}),this.registerEvent(this.app.workspace.on("editor-menu",(t,e,i)=>{if(!this.session.isActive)return;let o=e.getSelection();if(!o||o.trim().length===0)return;let n=i instanceof a.MarkdownView?i:null,s=(n==null?void 0:n.file)||this.app.workspace.getActiveFile();t.addItem(l=>{l.setTitle("\u{1F4DD} \uC18C\uC7AC\uB85C \uCD94\uAC00").setIcon("plus-circle").onClick(()=>{s?this.openThoughtModal(o,s.path):new a.Notice("Cannot determine source file")})})})),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{if(!this.session.isActive||!t)return;if(t.getViewState().type==="markdown"){let i=t.view.file;i&&i.path!==this.session.materialNotePath&&this.refreshConnectionsView(i.path)}})),this.addSettingTab(new F(this.app,this)),this.addRibbonIcon("brain","Start Thinking Tool",()=>{let t=this.app.workspace.getActiveFile();t?this.startThinkingSession(t):new a.Notice("Please open a note first")}),this.setupSelectionListener()}onunload(){this.app.workspace.detachLeavesOfType(S),this.removeFloatingButton()}setupSelectionListener(){this.floatingBtn=document.createElement("button"),this.floatingBtn.addClass("thinking-tool-floating-btn"),this.floatingBtn.setText("\u{1F4DD} \uC18C\uC7AC\uB85C \uCD94\uAC00"),this.floatingBtn.style.display="none",document.body.appendChild(this.floatingBtn),this.floatingBtn.onclick=t=>{if(t.preventDefault(),t.stopPropagation(),this.currentSelection){let e=this.app.workspace.getActiveFile();e&&this.openThoughtModal(this.currentSelection,e.path)}this.hideFloatingButton()},this.registerDomEvent(document,"mouseup",t=>{setTimeout(()=>this.handleSelectionChange(t),10)}),this.registerDomEvent(document,"mousedown",t=>{this.floatingBtn&&!this.floatingBtn.contains(t.target)&&this.hideFloatingButton()}),this.registerDomEvent(document,"keydown",()=>{this.hideFloatingButton()})}handleSelectionChange(t){if(!this.session.isActive)return;let e=window.getSelection(),i=e==null?void 0:e.toString().trim();i&&i.length>0?(this.currentSelection=i,this.showFloatingButton(t.clientX,t.clientY)):this.hideFloatingButton()}showFloatingButton(t,e){if(!this.floatingBtn)return;let i=120,o=32,n=t-i/2,s=e-o-10;n<10&&(n=10),n+i>window.innerWidth-10&&(n=window.innerWidth-i-10),s<10&&(s=e+20),this.floatingBtn.style.left=`${n}px`,this.floatingBtn.style.top=`${s}px`,this.floatingBtn.style.display="block"}hideFloatingButton(){this.floatingBtn&&(this.floatingBtn.style.display="none"),this.currentSelection=""}removeFloatingButton(){this.floatingBtn&&(this.floatingBtn.remove(),this.floatingBtn=null)}async loadSettings(){this.settings=Object.assign({},G,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async startThinkingSession(t){if(this.session.isActive){new a.Notice("A thinking session is already active. End it first.");return}let e=await this.createMaterialNote(t);if(!e){new a.Notice("Failed to create material note");return}this.session={isActive:!0,sourceFilePath:t.path,materialNotePath:e,leftLeafId:null,centerLeafId:null,rightLeafId:null},await this.setupThreePanelLayout(t.path,e),new a.Notice("Thinking session started! Select text and right-click to add materials.")}async endThinkingSession(){this.session.isActive&&(this.session={isActive:!1,sourceFilePath:null,materialNotePath:null,leftLeafId:null,centerLeafId:null,rightLeafId:null},this.app.workspace.detachLeavesOfType(S),new a.Notice("Thinking session ended"))}async createMaterialNote(t){var p;let e=t.basename+U,i=this.settings.materialNoteFolder||((p=t.parent)==null?void 0:p.path)||"";if(i=(0,a.normalizePath)(i),i){let u=this.app.vault.getAbstractFileByPath(i);if(u)u instanceof a.TFolder||(console.warn("Path is a file, not folder. Using vault root."),i="");else try{await this.app.vault.createFolder(i)}catch(h){console.log("Folder creation note:",h)}}let o=i?i+"/":"",n=(0,a.normalizePath)(`${o}${e}.md`),s=1;for(;this.app.vault.getAbstractFileByPath(n);)n=(0,a.normalizePath)(`${o}${e} ${s}.md`),s++;let l=`# Materials from [[${t.basename}]]

> [!info] Thinking Tool Session
> This note collects materials for article generation.
> Source: [[${t.basename}]]

---

`;try{return await this.app.vault.create(n,l),n}catch(u){console.error("Failed to create material note:",u);try{let h=(0,a.normalizePath)(`${e}.md`);return await this.app.vault.create(h,l),new a.Notice("Material note created in vault root (folder issue)"),h}catch(h){return console.error("Failed to create material note in root:",h),null}}}async appendMaterial(t,e,i){if(!this.session.materialNotePath)return;let o=this.app.vault.getAbstractFileByPath(this.session.materialNotePath);if(!(o instanceof a.TFile))return;let s=`
> [!quote] [[${e.replace(/\.md$/,"").split("/").pop()}]]
> ${t.split(`
`).join(`
> `)}
>
> **My Thought**: ${i||"_No thought added_"}

---

`,l=await this.app.vault.read(o);await this.app.vault.modify(o,l+s),new a.Notice("Material added!")}async setupThreePanelLayout(t,e){let i=this.app.workspace,o=i.getLeaf(),n=i.createLeafBySplit(o,"vertical");await n.setViewState({type:S,active:!1,state:{sourcePath:t}});let s=i.createLeafBySplit(n,"vertical");await s.openFile(this.app.vault.getAbstractFileByPath(e)),i.setActiveLeaf(o,{focus:!0}),this.session.leftLeafId=o.id,this.session.centerLeafId=n.id,this.session.rightLeafId=s.id,this.refreshConnectionsView(t)}async refreshConnectionsView(t){let e=this.app.workspace.getLeavesOfType(S);for(let i of e){let o=i.view;o&&await o.loadConnections(t)}}async getSmartConnections(t){var e,i,o;try{let n=(i=(e=this.app.plugins)==null?void 0:e.getPlugin)==null?void 0:i.call(e,"smart-connections");if(!n)return console.warn("Smart Connections plugin not found"),null;let s=n.env||(typeof globalThis!="undefined"?globalThis.smart_env:null);if(!s)return console.warn("Smart Connections environment not loaded"),null;s.state!=="loaded"&&await this.waitForSmartEnv(s);let l=(o=s.smart_sources)==null?void 0:o.get(t);return l?l.connections?await l.connections.get_results({limit:this.settings.connectionsLimit}):l.find_connections?await l.find_connections({limit:this.settings.connectionsLimit}):null:(console.warn("Source not found in Smart Connections:",t),null)}catch(n){return console.error("Error getting smart connections:",n),null}}waitForSmartEnv(t){return new Promise(e=>{let i=setInterval(()=>{t.state==="loaded"&&(clearInterval(i),e())},100);setTimeout(()=>{clearInterval(i),e()},1e4)})}openThoughtModal(t,e){new D(this.app,this,t,e).open()}openGenerateModal(){new $(this.app,this).open()}async generateTopicSuggestions(t,e){let o=`You are a creative writing assistant helping a writer craft compelling articles from their collected materials.

**CRITICAL: All output must be written in ${this.settings.outputLanguage||"\uD55C\uAD6D\uC5B4"}.**

## Collected Materials:
${t}

## Your Task:
Analyze the materials deeply and suggest **5 unique topic angles** for an article. Each suggestion should offer a distinct perspective:

1. **Mainstream Angle**: A conventional, accessible approach that most readers would expect
2. **Contrarian Angle**: A perspective that challenges common assumptions or conventional wisdom
3. **Personal/Emotional Angle**: A deeply personal, story-driven approach
4. **Analytical/Deep-dive Angle**: A thorough, research-oriented perspective
5. **Provocative/Bold Angle**: A daring, attention-grabbing take that sparks discussion

For each suggestion, provide:
- **title**: An engaging, click-worthy title (10-15 words max)
- **description**: A 2-3 sentence description of the angle and why it's compelling
- **outline**: 4-6 key points that structure the article

Respond ONLY with valid JSON (no markdown, no explanation):
[
  {
    "title": "\uC81C\uBAA9",
    "description": "\uC124\uBA85",
    "outline": ["\uD3EC\uC778\uD2B81", "\uD3EC\uC778\uD2B82", "\uD3EC\uC778\uD2B83", "\uD3EC\uC778\uD2B84"]
  }
]`;e==null||e("\uC18C\uC7AC \uBD84\uC11D \uC911...");let n=await this.callAI(o,e);try{let s=n,l=n.match(/```(?:json)?\s*([\s\S]*?)```/);l&&(s=l[1]);let p=s.match(/\[\s*\{[\s\S]*\}\s*\]/);p&&(s=p[0]),s=s.trim(),console.log("AI Response (first 500 chars):",n.substring(0,500)),console.log("Extracted JSON (first 500 chars):",s.substring(0,500));let u;try{u=JSON.parse(s)}catch(r){s=s.replace(/,\s*}/g,"}").replace(/,\s*\]/g,"]").replace(/[\u0000-\u001F]+/g," "),u=JSON.parse(s)}let h=u.filter(r=>(r==null?void 0:r.title)&&typeof r.title=="string"&&(r==null?void 0:r.description)&&typeof r.description=="string"&&Array.isArray(r==null?void 0:r.outline)&&r.outline.length>0).slice(0,5);if(h.length===0)throw console.error("No valid topics after validation. Raw topics:",u),new Error("\uC720\uD6A8\uD55C \uC8FC\uC81C\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4. AI \uC751\uB2F5\uC5D0\uC11C \uD544\uC218 \uD544\uB4DC(title, description, outline)\uB97C \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4.");return h}catch(s){console.error("Failed to parse topic suggestions:",{error:s,rawResponse:n.substring(0,1e3)});let l=s instanceof Error?s.message:"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";throw new Error(`\uC8FC\uC81C \uC81C\uC548 \uD30C\uC2F1 \uC2E4\uD328: ${l}`)}}async generateArticle(t,e,i){let o=this.settings.outputLanguage||"\uD55C\uAD6D\uC5B4",{topic:n,persona:s,length:l,customInstructions:p}=e,u={essay:"\uAE4A\uC774 \uC788\uB294 \uC131\uCC30\uC801 \uC5D0\uC138\uC774 \uC2A4\uD0C0\uC77C. \uBB38\uD559\uC801 \uAE30\uBC95\uACFC \uAC1C\uC778\uC801 \uD1B5\uCC30\uC744 \uD65C\uC6A9\uD558\uC138\uC694. \uC740\uC720, \uBE44\uC720\uB97C \uC801\uC808\uD788 \uC0AC\uC6A9\uD558\uACE0 \uB3C5\uC790\uC758 \uAC10\uC815\uC5D0 \uD638\uC18C\uD558\uC138\uC694.",blog:"\uCE5C\uADFC\uD558\uACE0 \uB300\uD654\uD558\uB4EF \uC4F0\uB294 \uBE14\uB85C\uADF8 \uC2A4\uD0C0\uC77C. \uC811\uADFC\uD558\uAE30 \uC27D\uC9C0\uB9CC \uB0B4\uC6A9\uC740 \uCDA9\uC2E4\uD558\uAC8C. \uB3C5\uC790\uC5D0\uAC8C \uC9C1\uC811 \uB9D0\uC744 \uAC70\uB294 \uB4EF\uD55C \uD1A4\uC744 \uC720\uC9C0\uD558\uC138\uC694.",academic:"\uD559\uC220\uC801\uC774\uACE0 \uB17C\uC99D\uC801\uC778 \uC2A4\uD0C0\uC77C. \uBA85\uD655\uD55C \uB17C\uB9AC \uAD6C\uC870\uC640 \uADFC\uAC70 \uC81C\uC2DC. \uAC1D\uAD00\uC801\uC778 \uD1A4\uC744 \uC720\uC9C0\uD558\uBA70 \uCCB4\uACC4\uC801\uC73C\uB85C \uC11C\uC220\uD558\uC138\uC694.",twitter:"\uD2B8\uC704\uD130/X \uC2A4\uB808\uB4DC \uD615\uC2DD. \uC9E7\uACE0 \uAC15\uB82C\uD55C \uBB38\uC7A5. \uAC01 \uD2B8\uC717\uC740 \uBC88\uD638\uB97C \uB9E4\uAE30\uACE0, \uD6C5(hook)\uC73C\uB85C \uC2DC\uC791\uD574 \uAE34\uC7A5\uAC10\uC744 \uC720\uC9C0\uD558\uC138\uC694. \uC774\uBAA8\uC9C0 \uC801\uC808\uD788 \uD65C\uC6A9.",newsletter:"\uB274\uC2A4\uB808\uD130 \uC2A4\uD0C0\uC77C. \uB3C5\uC790\uC5D0\uAC8C \uAC00\uCE58 \uC788\uB294 \uC778\uC0AC\uC774\uD2B8 \uC804\uB2EC. \uD575\uC2EC \uD3EC\uC778\uD2B8\uB97C \uBA85\uD655\uD788 \uD558\uACE0, \uC2E4\uD589 \uAC00\uB2A5\uD55C \uC870\uC5B8\uC744 \uD3EC\uD568\uD558\uC138\uC694.",storytelling:"\uC2A4\uD1A0\uB9AC\uD154\uB9C1 \uC2A4\uD0C0\uC77C. \uC774\uC57C\uAE30\uB85C \uC2DC\uC791\uD574 \uB3C5\uC790\uB97C \uB04C\uC5B4\uB4E4\uC774\uC138\uC694. \uAD6C\uCCB4\uC801\uC778 \uC0AC\uB840\uC640 \uC0DD\uC0DD\uD55C \uBB18\uC0AC\uB97C \uD65C\uC6A9\uD558\uC138\uC694.",custom:"\uBA85\uD655\uD558\uACE0 \uC804\uBB38\uC801\uC778 \uC2A4\uD0C0\uC77C. \uC811\uADFC\uC131\uACFC \uAE4A\uC774\uC758 \uADE0\uD615\uC744 \uB9DE\uCD94\uC138\uC694."},h={short:"800-1200\uC790 \uBD84\uB7C9\uC758 \uAC04\uACB0\uD55C \uAE00. \uD575\uC2EC\uB9CC \uBA85\uD655\uD558\uAC8C \uC804\uB2EC\uD558\uC138\uC694.",medium:"2000-3000\uC790 \uBD84\uB7C9\uC758 \uC801\uB2F9\uD55C \uAE38\uC774. \uCDA9\uBD84\uD55C \uC124\uBA85\uACFC \uC608\uC2DC\uB97C \uD3EC\uD568\uD558\uC138\uC694.",long:"4000-5000\uC790 \uBD84\uB7C9\uC758 \uC2EC\uCE35 \uAE00. \uC790\uC138\uD55C \uBD84\uC11D, \uB2E4\uC591\uD55C \uAD00\uC810, \uD48D\uBD80\uD55C \uC608\uC2DC\uB97C \uD3EC\uD568\uD558\uC138\uC694."},r=`\uB2F9\uC2E0\uC740 ${o}\uB85C \uAE00\uC744 \uC4F0\uB294 \uC219\uB828\uB41C \uC791\uAC00\uC785\uB2C8\uB2E4.

## \uAE00 \uC815\uBCF4
- **\uC81C\uBAA9**: ${n.title}
- **\uC811\uADFC \uBC29\uC2DD**: ${n.description}
- **\uC544\uC6C3\uB77C\uC778**:
${n.outline.map((m,d)=>`  ${d+1}. ${m}`).join(`
`)}

## \uCC38\uACE0 \uC18C\uC7AC
${t}

## \uC791\uC131 \uC9C0\uCE68
- **\uC2A4\uD0C0\uC77C**: ${u[s]}
- **\uBD84\uB7C9**: ${h[l]}
${p?`- **\uCD94\uAC00 \uC9C0\uC2DC**: ${p}`:""}

## \uC911\uC694 \uADDC\uCE59
1. \uBC18\uB4DC\uC2DC ${o}\uB85C \uC791\uC131\uD558\uC138\uC694
2. \uC218\uC9D1\uB41C \uC18C\uC7AC\uC758 \uB0B4\uC6A9\uACFC \uC791\uC131\uC790\uC758 \uC0DD\uAC01\uC744 \uC790\uC5F0\uC2A4\uB7FD\uAC8C \uB179\uC5EC\uB0B4\uC138\uC694
3. \uC18C\uC7AC\uC640 \uBAA8\uC21C\uB418\uB294 \uB0B4\uC6A9\uC744 \uCD94\uAC00\uD558\uC9C0 \uB9C8\uC138\uC694
4. \uC791\uC131\uC790\uC758 \uACE0\uC720\uD55C \uAD00\uC810\uACFC \uBAA9\uC18C\uB9AC\uB97C \uC720\uC9C0\uD558\uC138\uC694
5. \uC544\uC6C3\uB77C\uC778 \uAD6C\uC870\uB97C \uB530\uB974\uB418, \uC790\uC5F0\uC2A4\uB7EC\uC6B4 \uD750\uB984\uC744 \uB9CC\uB4DC\uC138\uC694
6. \uB3C4\uC785\uBD80\uC5D0\uC11C \uB3C5\uC790\uC758 \uAD00\uC2EC\uC744 \uC0AC\uB85C\uC7A1\uACE0, \uACB0\uB860\uC5D0\uC11C \uC5EC\uC6B4\uC744 \uB0A8\uAE30\uC138\uC694

\uC9C0\uAE08 \uBC14\uB85C \uC644\uC131\uB41C \uAE00\uC744 \uC791\uC131\uD558\uC138\uC694:`;return i==null||i("\uAE00 \uC0DD\uC131 \uC911..."),await this.callAI(r,i)}async callAI(t,e){let i=this.settings.aiProvider,o=null;for(let n=1;n<=E;n++)try{e==null||e(`AI \uD638\uCD9C \uC911... (\uC2DC\uB3C4 ${n}/${E})`);let s;return i==="gemini"?s=await this.callGeminiWithTimeout(t):i==="openai"?s=await this.callOpenAIWithTimeout(t):s=await this.callAnthropicWithTimeout(t),s}catch(s){if(o=s,console.error(`AI call attempt ${n} failed:`,s),n<E){let l=X*Math.pow(2,n-1);e==null||e(`\uC7AC\uC2DC\uB3C4 \uB300\uAE30 \uC911... (${l/1e3}\uCD08)`),await this.sleep(l)}}throw new Error(`AI \uD638\uCD9C \uC2E4\uD328 (${E}\uD68C \uC2DC\uB3C4): ${(o==null?void 0:o.message)||"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`)}sleep(t){return new Promise(e=>setTimeout(e,t))}async withTimeout(t,e){let i,o=new Promise((n,s)=>{i=setTimeout(()=>{s(new Error(`\uC694\uCCAD \uC2DC\uAC04 \uCD08\uACFC (${e/1e3}\uCD08)`))},e)});try{let n=await Promise.race([t,o]);return clearTimeout(i),n}catch(n){throw clearTimeout(i),n}}async callOpenAIWithTimeout(t){var n,s,l,p;if(!this.settings.openaiApiKey)throw new Error("OpenAI API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.");let e=(0,a.requestUrl)({url:"https://api.openai.com/v1/chat/completions",method:"POST",headers:{Authorization:`Bearer ${this.settings.openaiApiKey}`,"Content-Type":"application/json"},body:JSON.stringify({model:this.settings.openaiModel,messages:[{role:"user",content:t}],max_tokens:4e3,temperature:.7})}),i=await this.withTimeout(e,L);if(i.status===401)throw new Error("OpenAI API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");if(i.status===429)throw new Error("OpenAI API \uC0AC\uC6A9\uB7C9 \uD55C\uB3C4 \uCD08\uACFC. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.");if(i.status!==200)throw new Error(`OpenAI API \uC624\uB958 (${i.status}): ${i.text||"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`);let o=(p=(l=(s=(n=i.json)==null?void 0:n.choices)==null?void 0:s[0])==null?void 0:l.message)==null?void 0:p.content;if(!o)throw new Error("OpenAI \uC751\uB2F5 \uD615\uC2DD\uC774 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return o}async callAnthropicWithTimeout(t){var n,s,l;if(!this.settings.anthropicApiKey)throw new Error("Anthropic API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.");let e=(0,a.requestUrl)({url:"https://api.anthropic.com/v1/messages",method:"POST",headers:{"x-api-key":this.settings.anthropicApiKey,"Content-Type":"application/json","anthropic-version":"2023-06-01"},body:JSON.stringify({model:this.settings.anthropicModel,max_tokens:4e3,messages:[{role:"user",content:t}]})}),i=await this.withTimeout(e,L);if(i.status===401)throw new Error("Anthropic API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");if(i.status===429)throw new Error("Anthropic API \uC0AC\uC6A9\uB7C9 \uD55C\uB3C4 \uCD08\uACFC. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.");if(i.status!==200)throw new Error(`Anthropic API \uC624\uB958 (${i.status}): ${i.text||"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958"}`);let o=(l=(s=(n=i.json)==null?void 0:n.content)==null?void 0:s[0])==null?void 0:l.text;if(!o)throw new Error("Anthropic \uC751\uB2F5 \uD615\uC2DD\uC774 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return o}async callGeminiWithTimeout(t){var s,l,p,u,h,r,m,d,k,g,y;if(!this.settings.geminiApiKey)throw new Error("Gemini API \uD0A4\uAC00 \uC124\uC815\uB418\uC9C0 \uC54A\uC558\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C API \uD0A4\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.");let e=(0,a.requestUrl)({url:`https://generativelanguage.googleapis.com/v1beta/models/${this.settings.geminiModel}:generateContent?key=${this.settings.geminiApiKey}`,method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:t}]}],generationConfig:{maxOutputTokens:8e3,temperature:.7}})}),i=await this.withTimeout(e,L);if(i.status===400){let A=((l=(s=i.json)==null?void 0:s.error)==null?void 0:l.message)||"";throw new Error(`Gemini API \uC694\uCCAD \uC624\uB958: ${A||"API \uD0A4\uAC00 \uC720\uD6A8\uD558\uC9C0 \uC54A\uAC70\uB098 \uC694\uCCAD \uD615\uC2DD\uC774 \uC798\uBABB\uB418\uC5C8\uC2B5\uB2C8\uB2E4."}`)}else{if(i.status===403)throw new Error("Gemini API \uC811\uADFC \uAC70\uBD80. API \uD0A4 \uAD8C\uD55C\uC744 \uD655\uC778\uD558\uAC70\uB098 Google AI Studio(aistudio.google.com)\uC5D0\uC11C \uC0C8 \uD0A4\uB97C \uBC1C\uAE09\uBC1B\uC73C\uC138\uC694.");if(i.status===404){let A=this.settings.geminiModel;throw new Error(`Gemini \uBAA8\uB378 '${A}'\uC744 \uCC3E\uC744 \uC218 \uC5C6\uC2B5\uB2C8\uB2E4. \uC124\uC815\uC5D0\uC11C \uBAA8\uB378\uBA85\uC744 \uD655\uC778\uD558\uC138\uC694. (\uCD94\uCC9C: gemini-2.0-flash, gemini-1.5-pro)`)}else{if(i.status===429)throw new Error("Gemini API \uC0AC\uC6A9\uB7C9 \uD55C\uB3C4 \uCD08\uACFC. \uC7A0\uC2DC \uD6C4 \uB2E4\uC2DC \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694.");if(i.status!==200){let A=((u=(p=i.json)==null?void 0:p.error)==null?void 0:u.message)||i.text||"\uC54C \uC218 \uC5C6\uB294 \uC624\uB958";throw new Error(`Gemini API \uC624\uB958 (${i.status}): ${A}`)}}}let o=i.json,n=(k=(d=(m=(r=(h=o==null?void 0:o.candidates)==null?void 0:h[0])==null?void 0:r.content)==null?void 0:m.parts)==null?void 0:d[0])==null?void 0:k.text;if(!n)throw((y=(g=o==null?void 0:o.candidates)==null?void 0:g[0])==null?void 0:y.finishReason)==="SAFETY"?new Error("\uC548\uC804 \uD544\uD130\uC5D0 \uC758\uD574 \uC751\uB2F5\uC774 \uCC28\uB2E8\uB418\uC5C8\uC2B5\uB2C8\uB2E4. \uB2E4\uB978 \uC18C\uC7AC\uB85C \uC2DC\uB3C4\uD574\uC8FC\uC138\uC694."):new Error("Gemini \uC751\uB2F5 \uD615\uC2DD\uC774 \uC62C\uBC14\uB974\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return n}async createArticleNote(t,e){var h;if(!this.session.materialNotePath)return null;let i=this.app.vault.getAbstractFileByPath(this.session.materialNotePath);if(!(i instanceof a.TFile))return null;let o=((h=i.parent)==null?void 0:h.path)||"",n=e.title.replace(/[\\/:*?"<>|]/g,"-").slice(0,50),s=o?`${o}/${n}.md`:`${n}.md`,l=1;for(;this.app.vault.getAbstractFileByPath(s);)s=o?`${o}/${n} ${l}.md`:`${n} ${l}.md`,l++;let p=this.session.materialNotePath.replace(/\.md$/,"").split("/").pop(),u=`# ${e.title}

> [!info] Generated with Thinking Tool
> Materials: [[${p}]]
> Generated: ${new Date().toISOString().split("T")[0]}

---

${t}

---

## Sources

- Materials: [[${p}]]
`;try{return await this.app.vault.create(s,u)}catch(r){return console.error("Failed to create article note:",r),null}}},C=class extends a.ItemView{constructor(t,e){super(t);this.currentSourcePath=null;this.connections=[];this.isLoading=!1;this.plugin=e}getViewType(){return S}getDisplayText(){return"Smart Connections"}getIcon(){return"link"}async onOpen(){let t=this.containerEl.children[1];t.empty(),t.addClass("thinking-tool-connections-view"),this.render()}async onClose(){}async loadConnections(t){this.currentSourcePath=t,this.isLoading=!0,this.render();let e=await this.plugin.getSmartConnections(t);this.connections=e||[],this.isLoading=!1,this.render()}render(){var p,u,h,r,m;let t=this.containerEl.children[1];t.empty();let e=t.createDiv({cls:"view-header"});e.createEl("h4",{text:"Related Notes"});let i=e.createDiv({cls:"view-actions"}),o=i.createEl("button",{text:"\u21BB"});o.setAttribute("title","Refresh"),o.onclick=()=>{this.currentSourcePath&&this.loadConnections(this.currentSourcePath)};let n=i.createEl("button",{text:"\u270D\uFE0F \uAE00\uC4F0\uAE30"});n.setAttribute("title","Generate Article"),n.onclick=()=>{this.plugin.openGenerateModal()};let s=i.createEl("button",{text:"\u{1F3C1} \uB9C8\uAC10"});if(s.setAttribute("title","End Session"),s.style.backgroundColor="var(--interactive-accent)",s.style.color="var(--text-on-accent)",s.onclick=()=>{this.plugin.endThinkingSession()},this.isLoading){t.createDiv({cls:"loading-state",text:"Loading connections..."});return}if(this.connections.length===0){let d=t.createDiv({cls:"empty-state"});d.createDiv({cls:"empty-icon",text:"\u{1F517}"}),d.createEl("p",{text:"No connections found. Make sure Smart Connections plugin is installed and has indexed your notes."});return}let l=t.createDiv({cls:"connections-list"});for(let d of this.connections){let g=(((p=d.item)==null?void 0:p.path)||((h=(u=d.item)==null?void 0:u.data)==null?void 0:h.path)||((r=d.item)==null?void 0:r.key)||"").split("#")[0];if(g&&!g.endsWith(".md")&&(g=g+".md"),!g)continue;let y=l.createDiv({cls:"connection-item"}),A=((m=g.split("/").pop())==null?void 0:m.replace(/\.md$/,""))||g;y.createSpan({cls:"connection-title",text:A});let R=Math.round((d.score||0)*100);y.createSpan({cls:"connection-score",text:`${R}%`}),y.dataset.path=g;let K=async v=>{var B,N,O;console.log("ThinkingTool: Click handler fired for path:",v);let w=this.app.vault.getAbstractFileByPath(v);if(!w&&v.endsWith(".md")&&(w=this.app.vault.getAbstractFileByPath(v.slice(0,-3))),!w){let T=(B=v.split("/").pop())==null?void 0:B.replace(/\.md$/,"");T&&(w=this.app.vault.getMarkdownFiles().find(_=>_.basename===T)||null,console.log("ThinkingTool: Searching by basename:",T,"Found:",w==null?void 0:w.path))}if(!(w instanceof a.TFile)){new a.Notice("File not found: "+v),console.error("ThinkingTool: File not found:",v);return}console.log("ThinkingTool: Found file:",w.path);let V=this.plugin.session.materialNotePath,b=null,M=this.app.workspace.getLeavesOfType("markdown");console.log("ThinkingTool: Found markdown leaves:",M.length);for(let T of M){let P=(O=(N=T.view)==null?void 0:N.file)==null?void 0:O.path;if(console.log("ThinkingTool: Checking leaf with file:",P),P!==V){b=T;break}}b||(console.log("ThinkingTool: No suitable leaf found, creating new one"),b=this.app.workspace.getLeaf("split","vertical"));try{await b.openFile(w),this.plugin.session.leftLeafId=b.id,this.app.workspace.setActiveLeaf(b,{focus:!0}),await this.loadConnections(w.path),new a.Notice(`\u{1F4C4} ${w.basename}`),console.log("ThinkingTool: Successfully opened file")}catch(T){console.error("ThinkingTool: Error opening file:",T),new a.Notice("Error opening file: "+T)}};y.addEventListener("click",v=>{v.preventDefault(),v.stopPropagation(),K(g)})}}},D=class extends a.Modal{constructor(c,t,e,i){super(c),this.plugin=t,this.selectedText=e,this.sourcePath=i}onOpen(){var p;let{contentEl:c}=this;c.addClass("thinking-tool-modal"),c.createEl("h2",{text:"Add Material"}),c.createDiv({cls:"quote-preview"}).setText(this.selectedText.length>200?this.selectedText.slice(0,200)+"...":this.selectedText);let e=(p=this.sourcePath.split("/").pop())==null?void 0:p.replace(/\.md$/,"");c.createDiv({cls:"source-info",text:`From: ${e}`});let i=c.createDiv({cls:"thought-input-container"});i.createEl("label",{text:"What's your thought on this?"});let o=i.createEl("textarea",{cls:"thought-input"});o.placeholder="Add your reflection, connection, or insight...";let n=c.createDiv({cls:"modal-buttons"}),s=n.createEl("button",{cls:"btn-secondary",text:"Cancel"});s.onclick=()=>this.close();let l=n.createEl("button",{cls:"btn-primary",text:"Add Material"});l.onclick=async()=>{await this.plugin.appendMaterial(this.selectedText,this.sourcePath,o.value),this.close()},setTimeout(()=>o.focus(),100)}onClose(){let{contentEl:c}=this;c.empty()}},$=class extends a.Modal{constructor(t,e){super(t);this.step=1;this.topics=[];this.selectedTopic=null;this.editedOutline=[];this.selectedPersona="essay";this.selectedLength="medium";this.customInstructions="";this.isLoading=!1;this.loadingStatus="";this.lastError=null;this.materialsContent=null;this.materialCount=0;this.plugin=e}async onOpen(){let{contentEl:t}=this;t.addClass("thinking-tool-generate-modal"),this.materialsContent=await this.getMaterialsContent(),this.materialCount=this.countMaterials(this.materialsContent),await this.render()}countMaterials(t){if(!t)return 0;let e=t.match(/>\s*\[!quote\]/g);return e?e.length:0}async render(){let{contentEl:t}=this;t.empty(),t.createDiv({cls:"modal-header"}).createEl("h2",{text:"\u270D\uFE0F \uAE00 \uC0DD\uC131"});let i=["\uC8FC\uC81C \uC120\uD0DD","\uC544\uC6C3\uB77C\uC778 \uC218\uC815","\uC2A4\uD0C0\uC77C \uC124\uC815","\uC0DD\uC131"],o=t.createDiv({cls:"step-indicator"});for(let n=1;n<=4;n++){let s=o.createDiv({cls:`step ${n===this.step?"active":""} ${n<this.step?"completed":""}`});s.createSpan({cls:"step-number",text:n<this.step?"\u2713":String(n)}),s.createSpan({cls:"step-label",text:i[n-1]})}if(this.lastError){let n=t.createDiv({cls:"error-banner"});n.createSpan({text:`\u26A0\uFE0F ${this.lastError}`});let s=n.createEl("button",{text:"\uB2E4\uC2DC \uC2DC\uB3C4",cls:"btn-retry"});s.onclick=()=>{this.lastError=null,this.render(),this.step===1&&this.topics.length===0&&this.loadTopics()}}if(this.isLoading){let n=t.createDiv({cls:"loading-state"});n.createDiv({cls:"spinner"}),n.createEl("p",{text:this.loadingStatus||"\uCC98\uB9AC \uC911..."});return}switch(this.step){case 1:await this.renderStep1Topics(t);break;case 2:this.renderStep2Outline(t);break;case 3:this.renderStep3Style(t);break;case 4:await this.renderStep4Generate(t);break}}async renderStep1Topics(t){if(this.materialCount<1){let r=t.createDiv({cls:"empty-state"});r.createDiv({cls:"empty-icon",text:"\u{1F4DD}"}),r.createEl("h3",{text:"\uC18C\uC7AC\uAC00 \uC5C6\uC2B5\uB2C8\uB2E4"}),r.createEl("p",{text:"\uBA3C\uC800 \uB178\uD2B8\uC5D0\uC11C \uD14D\uC2A4\uD2B8\uB97C \uC120\uD0DD\uD558\uACE0 \uC18C\uC7AC\uB85C \uCD94\uAC00\uD574\uC8FC\uC138\uC694."});let m=t.createEl("button",{cls:"btn-primary",text:"\uB2EB\uAE30"});m.onclick=()=>this.close();return}if(t.createDiv({cls:"material-info"}).createSpan({text:`\u{1F4DA} \uC218\uC9D1\uB41C \uC18C\uC7AC: ${this.materialCount}\uAC1C`}),this.topics.length===0){await this.loadTopics();return}t.createEl("h3",{text:"\uC8FC\uC81C\uB97C \uC120\uD0DD\uD558\uC138\uC694"}),t.createEl("p",{cls:"step-description",text:"AI\uAC00 \uBD84\uC11D\uD55C 5\uAC00\uC9C0 \uAD00\uC810 \uC911 \uD558\uB098\uB97C \uC120\uD0DD\uD558\uAC70\uB098, \uC9C1\uC811 \uC8FC\uC81C\uB97C \uC785\uB825\uD558\uC138\uC694."});let i=t.createDiv({cls:"topic-options"});for(let r of this.topics){let m=this.selectedTopic===r,d=i.createDiv({cls:`topic-option ${m?"selected":""}`}),k=d.createDiv({cls:"topic-title-row"});k.createDiv({cls:"topic-title",text:r.title}),m&&k.createSpan({cls:"selected-badge",text:"\u2713 \uC120\uD0DD\uB428"}),d.createDiv({cls:"topic-description",text:r.description});let g=d.createDiv({cls:"outline-preview"});r.outline.slice(0,3).forEach(y=>{g.createDiv({cls:"outline-point",text:`\u2022 ${y}`})}),r.outline.length>3&&g.createDiv({cls:"outline-more",text:`+${r.outline.length-3}\uAC1C \uB354...`}),d.onclick=()=>{this.selectedTopic=r,this.editedOutline=[...r.outline],this.render()}}let o=t.createDiv({cls:"custom-topic-section"});o.createEl("h4",{text:"\uB610\uB294 \uC9C1\uC811 \uC785\uB825"});let n=o.createEl("input",{cls:"custom-topic-input",attr:{type:"text",placeholder:"\uC6D0\uD558\uB294 \uC8FC\uC81C\uB098 \uC81C\uBAA9\uC744 \uC785\uB825\uD558\uC138\uC694..."}}),s=o.createEl("button",{cls:"btn-secondary",text:"\uC774 \uC8FC\uC81C\uB85C \uC9C4\uD589"});s.onclick=()=>{let r=n.value.trim();r?(this.selectedTopic={title:r,description:"\uC0AC\uC6A9\uC790 \uC9C1\uC811 \uC785\uB825 \uC8FC\uC81C",outline:["\uC11C\uB860","\uBCF8\uB860 1","\uBCF8\uB860 2","\uACB0\uB860"]},this.editedOutline=[...this.selectedTopic.outline],this.step=2,this.render()):new a.Notice("\uC8FC\uC81C\uB97C \uC785\uB825\uD574\uC8FC\uC138\uC694.")};let l=t.createDiv({cls:"modal-buttons"}),p=l.createEl("button",{cls:"btn-secondary",text:"\u{1F504} \uB2E4\uB978 \uC8FC\uC81C \uC81C\uC548\uBC1B\uAE30"});p.onclick=()=>{this.topics=[],this.selectedTopic=null,this.render()};let u=l.createEl("button",{cls:"btn-secondary",text:"\uCDE8\uC18C"});u.onclick=()=>this.close();let h=l.createEl("button",{cls:"btn-primary",text:"\uB2E4\uC74C \u2192"});h.disabled=!this.selectedTopic,h.onclick=()=>{this.selectedTopic&&(this.step=2,this.render())}}renderStep2Outline(t){if(!this.selectedTopic)return;t.createEl("h3",{text:"\uC544\uC6C3\uB77C\uC778 \uC218\uC815"}),t.createEl("p",{cls:"step-description",text:"\uAE00\uC758 \uAD6C\uC870\uB97C \uD655\uC778\uD558\uACE0 \uD544\uC694\uD558\uBA74 \uC218\uC815\uD558\uC138\uC694. \uD56D\uBAA9\uC744 \uCD94\uAC00/\uC0AD\uC81C/\uC218\uC815\uD560 \uC218 \uC788\uC2B5\uB2C8\uB2E4."});let e=t.createDiv({cls:"selected-topic-info"});e.createEl("strong",{text:this.selectedTopic.title}),e.createEl("p",{text:this.selectedTopic.description});let i=t.createDiv({cls:"outline-editor"});this.editedOutline.forEach((p,u)=>{let h=i.createDiv({cls:"outline-row"});h.createSpan({cls:"outline-number",text:`${u+1}.`});let r=h.createEl("input",{cls:"outline-input",attr:{type:"text",value:p}});r.oninput=()=>{this.editedOutline[u]=r.value};let m=h.createEl("button",{cls:"btn-icon btn-delete",text:"\u2715"});m.onclick=()=>{this.editedOutline.length>2?(this.editedOutline.splice(u,1),this.render()):new a.Notice("\uCD5C\uC18C 2\uAC1C \uC774\uC0C1\uC758 \uD56D\uBAA9\uC774 \uD544\uC694\uD569\uB2C8\uB2E4.")}});let o=i.createEl("button",{cls:"btn-add-outline",text:"+ \uD56D\uBAA9 \uCD94\uAC00"});o.onclick=()=>{this.editedOutline.push("\uC0C8 \uD56D\uBAA9"),this.render()};let n=t.createDiv({cls:"modal-buttons"}),s=n.createEl("button",{cls:"btn-secondary",text:"\u2190 \uC774\uC804"});s.onclick=()=>{this.step=1,this.render()};let l=n.createEl("button",{cls:"btn-primary",text:"\uB2E4\uC74C \u2192"});l.onclick=()=>{this.selectedTopic.outline=[...this.editedOutline],this.step=3,this.render()}}renderStep3Style(t){t.createEl("h3",{text:"\uC2A4\uD0C0\uC77C \uC124\uC815"}),t.createEl("p",{cls:"step-description",text:"\uAE00\uC758 \uC2A4\uD0C0\uC77C\uACFC \uAE38\uC774\uB97C \uC120\uD0DD\uD558\uC138\uC694."}),t.createEl("h4",{text:"\uAE00 \uC2A4\uD0C0\uC77C"});let e=[{key:"essay",label:"\u{1F4DD} \uC5D0\uC138\uC774",desc:"\uAE4A\uC774 \uC788\uB294 \uC131\uCC30\uC801 \uAE00"},{key:"blog",label:"\u{1F4AC} \uBE14\uB85C\uADF8",desc:"\uCE5C\uADFC\uD558\uACE0 \uB300\uD654\uCCB4"},{key:"newsletter",label:"\u{1F4E7} \uB274\uC2A4\uB808\uD130",desc:"\uC778\uC0AC\uC774\uD2B8 \uC804\uB2EC"},{key:"storytelling",label:"\u{1F4D6} \uC2A4\uD1A0\uB9AC\uD154\uB9C1",desc:"\uC774\uC57C\uAE30\uB85C \uD480\uC5B4\uB0B4\uAE30"},{key:"academic",label:"\u{1F4DA} \uD559\uC220\uC801",desc:"\uB17C\uC99D\uC801, \uCCB4\uACC4\uC801"},{key:"twitter",label:"\u{1F426} \uD2B8\uC704\uD130 \uC2A4\uB808\uB4DC",desc:"\uC9E7\uACE0 \uAC15\uB82C\uD558\uAC8C"}],i=t.createDiv({cls:"persona-selector"});for(let h of e){let r=i.createDiv({cls:`persona-option ${this.selectedPersona===h.key?"selected":""}`});r.createDiv({cls:"persona-label",text:h.label}),r.createDiv({cls:"persona-desc",text:h.desc}),r.onclick=()=>{this.selectedPersona=h.key,this.render()}}t.createEl("h4",{text:"\uAE00 \uAE38\uC774"});let o=[{key:"short",label:"\uC9E7\uAC8C",desc:"800-1200\uC790"},{key:"medium",label:"\uBCF4\uD1B5",desc:"2000-3000\uC790"},{key:"long",label:"\uAE38\uAC8C",desc:"4000-5000\uC790"}],n=t.createDiv({cls:"length-selector"});for(let h of o){let r=n.createDiv({cls:`length-option ${this.selectedLength===h.key?"selected":""}`});r.createDiv({cls:"length-label",text:h.label}),r.createDiv({cls:"length-desc",text:h.desc}),r.onclick=()=>{this.selectedLength=h.key,this.render()}}t.createEl("h4",{text:"\uCD94\uAC00 \uC9C0\uC2DC (\uC120\uD0DD\uC0AC\uD56D)"});let s=t.createEl("textarea",{cls:"custom-instructions",attr:{placeholder:"\uC608: \uB3C5\uC790\uCE35\uC740 20-30\uB300 \uC9C1\uC7A5\uC778\uC785\uB2C8\uB2E4. \uC2E4\uC6A9\uC801\uC778 \uC870\uC5B8\uC744 \uAC15\uC870\uD574\uC8FC\uC138\uC694."}});s.value=this.customInstructions,s.oninput=()=>{this.customInstructions=s.value};let l=t.createDiv({cls:"modal-buttons"}),p=l.createEl("button",{cls:"btn-secondary",text:"\u2190 \uC774\uC804"});p.onclick=()=>{this.step=2,this.render()};let u=l.createEl("button",{cls:"btn-primary btn-generate",text:"\u2728 \uAE00 \uC0DD\uC131\uD558\uAE30"});u.onclick=()=>{this.step=4,this.render()}}async renderStep4Generate(t){if(!(!this.selectedTopic||!this.materialsContent)){this.isLoading=!0,this.loadingStatus="\uAE00 \uC0DD\uC131 \uC900\uBE44 \uC911...",this.render();try{let e={topic:this.selectedTopic,persona:this.selectedPersona,length:this.selectedLength,customInstructions:this.customInstructions||void 0},i=await this.plugin.generateArticle(this.materialsContent,e,n=>{this.loadingStatus=n}),o=await this.plugin.createArticleNote(i,this.selectedTopic);if(o)new a.Notice("\u2705 \uAE00\uC774 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4!"),await this.app.workspace.getLeaf().openFile(o),this.close();else throw new Error("\uB178\uD2B8 \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.")}catch(e){this.isLoading=!1,this.lastError=e.message,this.step=3,this.render()}}}async loadTopics(){if(this.materialsContent){this.isLoading=!0,this.loadingStatus="\uC18C\uC7AC \uBD84\uC11D \uC911...",this.render();try{this.topics=await this.plugin.generateTopicSuggestions(this.materialsContent,t=>{this.loadingStatus=t}),this.isLoading=!1,this.lastError=null,this.render()}catch(t){this.isLoading=!1,this.lastError=t.message,this.render()}}}async getMaterialsContent(){if(!this.plugin.session.materialNotePath)return null;let t=this.app.vault.getAbstractFileByPath(this.plugin.session.materialNotePath);return t instanceof a.TFile?await this.app.vault.read(t):null}onClose(){let{contentEl:t}=this;t.empty()}},F=class extends a.PluginSettingTab{constructor(c,t){super(c,t),this.plugin=t}display(){let{containerEl:c}=this;c.empty(),c.addClass("thinking-tool-settings"),c.createEl("h2",{text:"Thinking Tool Settings"}),c.createEl("h3",{text:"AI Provider"}),new a.Setting(c).setName("Provider").setDesc("Choose your AI provider").addDropdown(t=>t.addOption("gemini","Google Gemini (Recommended)").addOption("openai","OpenAI").addOption("anthropic","Anthropic (Claude)").setValue(this.plugin.settings.aiProvider).onChange(async e=>{this.plugin.settings.aiProvider=e,await this.plugin.saveSettings()})),c.createEl("h4",{text:"Google Gemini"}),new a.Setting(c).setName("API Key").setDesc("Your Google AI Studio API key (aistudio.google.com)").addText(t=>t.setPlaceholder("AIza...").setValue(this.plugin.settings.geminiApiKey).onChange(async e=>{this.plugin.settings.geminiApiKey=e,await this.plugin.saveSettings()})),new a.Setting(c).setName("Model").setDesc("Gemini model to use").addText(t=>t.setPlaceholder("gemini-2.5-flash").setValue(this.plugin.settings.geminiModel).onChange(async e=>{this.plugin.settings.geminiModel=e,await this.plugin.saveSettings()})),c.createEl("h4",{text:"OpenAI"}),new a.Setting(c).setName("API Key").setDesc("Your OpenAI API key").addText(t=>t.setPlaceholder("sk-...").setValue(this.plugin.settings.openaiApiKey).onChange(async e=>{this.plugin.settings.openaiApiKey=e,await this.plugin.saveSettings()})),new a.Setting(c).setName("Model").setDesc("OpenAI model to use").addText(t=>t.setPlaceholder("gpt-4o").setValue(this.plugin.settings.openaiModel).onChange(async e=>{this.plugin.settings.openaiModel=e,await this.plugin.saveSettings()})),c.createEl("h4",{text:"Anthropic"}),new a.Setting(c).setName("API Key").setDesc("Your Anthropic API key").addText(t=>t.setPlaceholder("sk-ant-...").setValue(this.plugin.settings.anthropicApiKey).onChange(async e=>{this.plugin.settings.anthropicApiKey=e,await this.plugin.saveSettings()})),new a.Setting(c).setName("Model").setDesc("Anthropic model to use").addText(t=>t.setPlaceholder("claude-sonnet-4-20250514").setValue(this.plugin.settings.anthropicModel).onChange(async e=>{this.plugin.settings.anthropicModel=e,await this.plugin.saveSettings()})),c.createEl("h3",{text:"General"}),new a.Setting(c).setName("Material Notes Folder").setDesc("Folder to save material notes (leave empty for same folder as source)").addText(t=>t.setPlaceholder("Materials").setValue(this.plugin.settings.materialNoteFolder).onChange(async e=>{this.plugin.settings.materialNoteFolder=e,await this.plugin.saveSettings()})),new a.Setting(c).setName("Connections Limit").setDesc("Maximum number of related notes to show").addSlider(t=>t.setLimits(5,50,5).setValue(this.plugin.settings.connectionsLimit).setDynamicTooltip().onChange(async e=>{this.plugin.settings.connectionsLimit=e,await this.plugin.saveSettings()})),c.createEl("h3",{text:"Writing / \uAE00\uC4F0\uAE30"}),new a.Setting(c).setName("Output Language / \uCD9C\uB825 \uC5B8\uC5B4").setDesc("Language for AI-generated content / AI\uAC00 \uC0DD\uC131\uD558\uB294 \uAE00\uC758 \uC5B8\uC5B4").addDropdown(t=>t.addOption("\uD55C\uAD6D\uC5B4","\uD55C\uAD6D\uC5B4 (Korean)").addOption("English","English").addOption("\u65E5\u672C\u8A9E","\u65E5\u672C\u8A9E (Japanese)").addOption("\u4E2D\u6587","\u4E2D\u6587 (Chinese)").addOption("Espa\xF1ol","Espa\xF1ol (Spanish)").addOption("Fran\xE7ais","Fran\xE7ais (French)").addOption("Deutsch","Deutsch (German)").setValue(this.plugin.settings.outputLanguage).onChange(async e=>{this.plugin.settings.outputLanguage=e,await this.plugin.saveSettings()}))}};
